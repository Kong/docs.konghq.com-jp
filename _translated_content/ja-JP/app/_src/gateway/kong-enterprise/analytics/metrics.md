---
title: "Vitalsメトリクス"
badge: "enterprise"
---
Vitalsメトリクスは次の2つのカテゴリに分類されます。

* Health メトリクス— Kong クラスタのヘルスを監視するためのものです。
* トラフィックメトリクス — アップストリームサービスの使用状況を監視します。

すべてのメトリクスは1秒間隔で収集され、1分間隔で集計されます。1秒間隔は1時間保持されます。1分間間隔は25時間保持されます。

保持期間をより長くする必要がある場合は、Vitals APIを使用してKongからメトリクスを引き出し、データ保持ツールに引き入れることができます。

ヘルスメトリクス
--------

ヘルスメトリクスは、たとえばクラスタが処理しているリクエストの数とそれらのリクエストの待ち時間など、Kongクラスタのパフォーマンスを把握するのに役立ちます。

ヘルスメトリクスは、クラスタ全体だけでなく、クラスタ内の各ノードで
追跡されます。Kongでは、ノードは一意の識別子、構成、キャッシュレイアウト、
KongのデータストアとそれがプロキシするアップストリームAPI両方への接続を持つ、
実行中のプロセスです。ノード識別子はプロセスに固有のものであり、プロセスが実行される
ホストに固有のものではないことに注意してください。つまり、Kongを再起動するたびに新しいノードが
生成され、その結果新しいノードIDが生成されます。

### レイテンシ

Vitals APIは、レイテンシメトリクスに対してnullを返す場合があります。これは、APIリクエストが
時間枠内にプロキシされなかった場合に発生します。nullレイテンシはKong Manager内でグラフに
表示されません。nullレイテンシの期間は、Vitalsチャートのギャップとして表示されます。

#### プロキシレイテンシ（リクエスト）

プロキシレイテンシーメトリクスは、KongプロキシがAPIプロキシリクエストの処理にかかる時間の最小値、最大値、平均値（ミリ秒単位）です。これには、アクセスフェーズで実行されるプラグインの実行時間とDNSルックアップ時間が含まれます。これには、Kongのロードバランサーで費やされた時間、アップストリームへのリクエストの送信に費やされた時間、または応答に費やされた時間は含まれません。

これらのメトリクスは、Vitals API で次のラベルを使用して参照されます： `latency_proxy_request_min_ms` 、 `latency_proxy_request_max_ms` 、 `latency_proxy_request_avg_ms` 。

リクエストがKongによって途中で終了した場合（不正な認証、レート制限など）、レイテンシは報告されません。これは、そのようなリクエストをカウントする **Total Requests** メトリクスとは異なることに注意してください。

#### アップストリームレイテンシ

アップストリームのレイテンシ メトリクスは、Kong がアップストリームにリクエストを送信してから Kong がアップストリームからレスポンスの最初のバイトを受信するまでの経過時間（ミリ秒単位）の最小値、最大値、平均値です。

これらのメトリクスは、Vitals API で次のラベルを使用して参照されます： `latency_upstream_min_ms` 、 `latency_upstream_max_ms` 、 `latency_upstream_avg_ms` 。

### データストアのキャッシュ

#### データストアのキャッシュヒット/ミス

データストアのCache Hit/Missメトリクスは、Kongのノードレベルのデータストアキャッシュへのリクエスト数です。Kongワーカーが特定の APIプロキシリクエストに応答するために構成情報を必要とする場合、まずワーカー固有のキャッシュ（L1 キャッシュ）を確認し、情報が利用できない場合は、ノード全体のデータストアキャッシュ（L2 キャッシュ）を確認します。どちらのキャッシュにも必要な情報が含まれていない場合、Kongはデータストアから情報を要求します。

`Hit`は、エンティティがデータストアキャッシュから取得されたことを示します。`Miss`は、レコードがデータストアから取得される必要があったことを示します。すべてのAPIリクエストがデータストアキャッシュアクセスにつながるわけではありません。一部のエンティティはKongのワーカー固有のキャッシュメモリから取得されます。

これらのメトリクスは、Vitals API で次のラベルを使用して参照されます: `cache_datastore_hits_total` 、 `cache_datastore_misses_total` 。

#### データストアのキャッシュヒット率

このメトリクスには、データストアのキャッシュリクエストの総数に対するデータストアのキャッシュヒット数の比率が含まれます。
> 
> **注：** ヒットもミスもない時間インデックスのデータストアのキャッシュヒット率を計算することはできません。

トラフィックメトリクス
-----------

トラフィックメトリクスは、どのサービスが使用されているか、誰が使用しているか、そしてどのように反応しているかについてのインサイトを提供します。

### リクエスト数

#### 合計リクエスト数

このメトリクスは受信したすべてのAPIプロキシリクエストのカウントです。これには、流量制限、認証の失敗などにより拒否されたリクエストが含まれます。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `requests_proxy_total` 。

#### コンシューマあたりのリクエスト数

このメトリクスは、特定の各コンシューマから受信したすべてのAPIプロキシリクエストの数です。コンシューマは、使用中のKong Authプラグインの要件に応じて、リクエスト内の認証情報（API キー、OAuth トークンなど）によって識別されます。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `requests_consumer_total` 。

### ステータスコード

#### ステータスコードクラスの合計

このメトリクスは、ステータスコードクラスごとにグループ化されたすべてのステータスコードの数です（例えば4xx、5xx）。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `status_code_classes_total` 。

#### サービスごとの合計ステータスコード

このメトリックは、特定のサービスのそれぞれの特定のステータスコードの合計数です。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `status_codes_per_service_total` 。

#### ルートごとの合計ステータスコード

このメトリクスは、特定のルートに対する各ステータスコードごとの総数です。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `status_codes_per_route_total` 。

#### コンシューマごとの合計ステータスコード

このメトリクスは、特定のコンシューマに対する各ステータスコードごとの総数です。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `status_codes_per_consumer_total` 。

#### ルートにおけるコンシューマごとの合計ステータスコード

このメトリックは、特定のコンシューマとルートに対する各ステータスコードの合計数です。

このメトリクスは、Vitals API で次のラベルを使用して参照されます: `status_codes_per_consumer_route_total` 。

