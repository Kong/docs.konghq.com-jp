---
title: "Vitalsの概要"
badge: "enterprise"
---
Kong Vitals（Vitals）を使用して、 {{site.ee_product_name}}のヘルスとパフォーマンスを監視し、Kongを通過するマイクロサービス APIトランザクションを把握します。Vitals は視覚的なAPI分析を使用して、APIとゲートウェイのパフォーマンスを正確に把握します。主要な統計情報に素早くアクセスし、バイタルサインを監視し、異常をリアルタイムで正確に特定します。

* Kong Admin API を使用して、エンドポイント経由で Vitals データにアクセスします。Vitals API を使用して一般的な監視システムと統合すると、他のシステムのデータと並べて Vitals データのダッシュボードを作成するなど、追加の視覚化を実現できます。

* Kong Managerを使用して、ワークスペースの概要ダッシュボード、ワークスペースチャート、Vitalsタブ、ステータスコードなどのVitalsデータの視覚化を表示します。

![Vitalsの概要](/assets/images/products/gateway/vitals/vitals_overview.png)

前提条件
----

Vitalsは{{site.ee_product_name}}でデフォルトで有効になっており、スーパー管理者として最初にログインしたときから使用できます。

{% if_version lte:3.3.x %}
{% include_cached /md/enterprise/cassandra-deprecation.md length='short' release=page.release %}
{% endif_version %}

Vitalsでは、次のいずれかのストレージストラテジを使用できます。

* Kong データベース: 
  * PostgresSQL 9\.5\+

* 独立したストレージエンジン：
  * InfluxDB
  * Prometheus

Vitalsの表示に関するガイドライン
-------------------

Vitalsを使用する際は、次の点に注意します。

* Vitals はデフォルトで有効になっており、スーパー管理者が初めてログインしたときにアクセスできます。 
  * Vitalsを有効または無効にする方法については、[Vitalsの有効化または無効化](#enable-or-disable-vitals)を参照してください。

* 権限を持つユーザーなら誰でも、Kongクラスタ全体または特定のワークスペースのVitalsを確認できます。
  * ユーザーがワークスペースに対するアクセス権がない場合、その Vitals は非表示になります。
  * ユーザーがVitalsデータにアクセスできない場合、グラフは表示されません。

Vitals API
----------

VitalsデータはVitals APIを使用して利用できます。これらのエンドポイントへのアクセスは、RBACを使用して管理できます。

Vitals APIは、Open API仕様を使用して記述されます。[`vitals.yaml`](/api/vitals.yaml)ファイルをダウンロードすると表示できます。APIを使用して、クラスタのヘルスおよびトラフィック情報を取得します。

たとえば、次の`GET`リクエストを発行することで、APIを使用してワークスペース内のサービスのリクエスト数を取得できます。

```bash
curl -i -X GET http://localhost:8001/WORKSPACE_NAME/vitals/status_codes/by_service \
    -d "service_id=030f4ade-69ed-48b0-b3e1-cd088a1f2a09" \
    -d "interval=minutes"
```

リクエストが成功すると、次のデータを含むペイロードが返されます。

```json
{
"stats": {
	"cluster": {
		"1673366520": {
			"200": 44
		},
		"1673366580": {
			"200": 49
		},
		"1673366460": {
			"200": 13
		}
	}
},
	"meta": {
	"earliest_ts": 1673343331,
	"latest_ts": 1673366580,
	"stat_labels": [
		"status_codes_per_service_total"
	],
	"level": "cluster",
	"entity_type": "service",
	"interval": "minutes",
	"workspace_id": "af622cf4-f636-4ae4-9aa5-2726d6713edf"
	}
}
```

Kong ManagerでVitalsを表示する
------------------------

次のいずれかを使用して、Kong ManagerでVitals情報を表示します。

* 概要ダッシュボードはワークスペースページからアクセスでき、Kongクラスタの概要を表示したり、選択したワークスペースの概要の個別のワークスペースを表示できます。
* 概要ダッシュボードの下のワークスペースページに表示されるワークスペースチャート。これらのグラフでは、個々のワークスペースのステータスの概要を簡単に確認できます。
* Vitalsタブには、合計リクエスト数、レイテンシ、キャッシュ情報など、Kongクラスタに関する詳細情報が表示されます。
* クラスタ全体のステータスコードクラスを表示するためのステータスコード。

概要ダッシュボード
---------

Kong Manager にログインすると、デフォルトでワークスペースページが表示されます。ページの上部に表示されるVitals概要ダッシュボードでは、APIとゲートウェイの状態とパフォーマンス、リクエストの合計、平均エラー率、コンシューマの合計、サービスの合計など、Kongクラスタの概要が表示されます。このVitals概要ダッシュボードを使用すると、管理者は注意が必要な問題を、簡単にすばやく特定できます。

ワークスペースチャート
-----------

ワークスページの概要ダッシュボードの下にあるワークスペースセクションには、各ワークスペースに、そのワークスペースに最近追加されたサービス、コンシューマ、プラグインに関するVitalsを示すグラフが表示されます。座標にカーソルを合わせると、特定のタイムスタンプでの成功とエラーの正確な数が表示されます。または、ワークスペースのグラフにドリルダウンすると詳細が表示されます。

Vitalsタブ
--------

Vitalsタブ、またはVitalsビューには、KongノードとKongプロキシAPIの正常性とパフォーマンスに関するメトリクスが表示されます。Vitals ビューには、合計リクエスト数、レイテンシ、キャッシュ情報が表示されます。

Vitalsビューまたはグラフ内の領域に入力するオプションには、次のものがあります。

|     オプション     |                                                                                           説明                                                                                            |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 時間枠セレクタ       | 時間枠セレクタは視覚化データの時間枠を制御することで、データの粒度を間接的に制御します。たとえば、「過去5分間」を選択すると表示データの解像度は1秒となりますが、より長い時間枠では表示データの解像度は1分となります。                                                                            |
| ビュー           | ホスト名、ホスト名 \+ ID、またはID別にVitalsチャートを入力するように選択します。                                                                                                                                        |
| リクエスト総数       | 合計リクエスト数チャートには、受信したすべてのプロキシリクエスト数が表示されます。これには、流量制限、認証の失敗などにより拒否されたリクエストが含まれます。                                                                                                          |
| クラスターとノードのデータ | メトリクスは、ノードレベルとクラスターレベルの両方で Vitals チャートに表示されます。クラスター全体のメトリクスやノード固有のメトリクスを表示するためのコントロールが利用できます。個々のノードをクリックすると、それらのノードのデータの表示が切り替わります。ノードは、一意の Kong ノード識別子、ホスト名、またはその 2 つの組み合わせによって識別されます。 |

ステータスコード
--------

ステータスコードビューには、視覚化されたクラスタ全体のステータスコードクラス（1xx、2xx、3xx、4xx、5xx）が表示されます。ステータスコードビューには、ステータスコードクラスの数が時系列でグラフ化され、合計リクエスト数に対するコードクラスの比率が表示されます。[ステータスコード](/gateway/{{page.release}}/kong-enterprise/analytics/metrics/#status-codes)を参照してください。
> 
> **注** ：ステータスコードビューには、非標準のコードクラス（6xx、7xxなど）は含まれていません。個々のステータスコードデータは、［アクティビティ］タブの「コンシューマ」、「ルート」、「サービス」の詳細ページで確認できます。これらのビューには、標準ステータスコードと非標準ステータスコードの両方が表示されます。

Vitals を有効化または無効化
-----------------


{{site.ee_product_name}}はデフォルトでVitalsが有効になり送信されます。Vitalsを有効または無効にするには、構成ファイルまたは環境変数を編集します。

{% navtabs %}
{% navtab Using kong.conf %}

1. 構成ファイルを編集して、Vitalsを有効または無効にします。 

   ```bash
   # via your Kong configuration file; e.g., kong.conf
   vitals = on  # vitals is enabled
   vitals = off # vitals is disabled
   ```

2. Kongを再起動します。

{% endnavtab %}
{% navtab Using environment variables %}

1. 環境変数を使用して、Vitalsを有効または無効にします。

   ```bash
   # or via environment variables
   export KONG_VITALS=on
   export KONG_VITALS=off
   ```

2. Kongを再起動します。

{% endnavtab %}
{% endnavtabs %}

