---
title: "コントロールプレーン（CP）の停止管理について"
badge: "enterprise"
content_type: "Reference"
---
バージョン3\.2以降、{{site.base_gateway}}を設定して、コントロールプレーン（CP）が停止した場合に新しいデータプレーン（DP）を構成するのをサポートできます。このドキュメントでは、データプレーン（DP）のレジリエンスの仕組み、誰が使用すべきか、その他の考慮事項について説明します。これを設定する手順については、[データプレーン（DP）レジリエンスドキュメント](/gateway/latest/kong-enterprise/cp-outage-handling/)を参照してください。

データプレーンのレジリエンスの仕組み
------------------

クラスタが新しいデータプレーンノードを追加すると、コントロールプレーンは構成ファイルを使用してそれらのノードをプロビジョニングします。コントロールプレーンが停止した場合、データプレーンはプロビジョニングできず、コントロールプレーンとの接続が確立されるまで何も表示されずに失敗します。コントロールプレーンが停止した場合に、新しいデータプレーンノードの追加を管理するように{{site.base_gateway}}を構成すると、コントロールプレーンとの接続が確立されなくても、新しいノードが何も表示せずに失敗することはありません。代わりに、指定されたS3互換ストレージボリュームにある構成ファイルを読み取ることによって構成されます。

専用バックアップノードを指定すると、構成ファイルに加えられたすべての変更はS3互換ストレージにプッシュされます。新しいデータプレーン（DP）ノードは、S3互換ストレージボリュームから構成ファイルを読み取り、新しい構成変更を適用します。

コントロールプレーン（CP）の停止中のデータプレーン（DP）管理
--------------------------------

コントロールプレーン（CP）にアクセスできない場合にクラスタに新しいデータプレーン（DP）ノードを追加すると、次の動作を示します。

1. 新しいデータプレーンノードは、コントロールプレーンに到達できないと判断します。
2. 新しいデータプレーンノードは、S3互換のストレージボリュームから設定ファイルを読み込み、自身を設定し、取得した設定ファイルをキャッシュして、リクエストのプロキシ処理を開始します。
3. 新しいデータプレーン（DP）ノードは、コントロールプレーン（CP）との接続を継続的に確立しようとします。

S3 互換のストレージボリュームには、データプレーンノードが作成されたときにのみアクセスされます。作成後に構成がストレージからプルされることはありません。データプレーンがコントロールプレーンの他の機能に依存している場合、データプレーンは失敗します。

{:.important}
> 
> データプレーン（DP）とコントロールプレーン（CP）が両方とも `export`を構成に設定されている場合、どちらも適切な認証レベルで構成されていると仮定すると、データプレーン（DP）は最初にストレージボリュームに書き込み、次にコントロールプレーン（CP）が設定を上書きします。この構成は避けてください。

セキュリティに関する考慮事項
--------------

ストレージボリューム書き込みアクセスは、バックアップノードにのみ許可されます。ストレージボリュームの構成を暗号化するために、ストレージプロバイダーが推奨する暗号化モジュールを適用するのはあなたの責任です。

このノードの使用者
---------

このモードは、厳格な高可用性SLAの遵守が必要な状況でのみ使用してください。ほとんどの場合、これは必要ありません。

### {{site.base_gateway}}構成パラメータ

データプレーンのレジリエンスは、 `kong.conf` 構成ファイルで次のパラメータによって管理されます。

    cluster_fallback_config_import: on
    cluster_fallback_config_storage: $AWS_STORAGE_ENDPOINT
    cluster_fallback_config_export = off

|               パラメータ               |                                                   説明                                                    |
|-----------------------------------|---------------------------------------------------------------------------------------------------------|
| `cluster_fallback_config_import`  | CP に到達できない場合は、`cluster_fallback_config_storage` に渡された URL からフォールバック構成を取得します。これは、データプレーンでのみ有効にする必要があります。 |
| `cluster_fallback_config_storage` | これは、ストレージボリュームのURLです。このストレージボリュームの認証情報は、環境変数として渡される必要があります。                                             |
| `cluster_fallback_config_export`  | ストレージボリュームに構成をアップロードできるようにします。バックアップノードでのみ有効にします。                                                       |

