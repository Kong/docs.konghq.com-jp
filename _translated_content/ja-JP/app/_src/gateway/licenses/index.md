---
title: "Kong Gatewayライセンス"
badge: "enterprise"
---

{{site.base_gateway}}は、ライセンスの有無にかかわらず使用できます。Enterprise機能では、{{site.base_gateway}}は
{{site.konnect_product_name}}ライセンスファイルの存在と有効性を適用します。

|    機能     |           フリーモード            |     Enterpriseサブスクリプション     |
|-----------|:---------------------------:|:---------------------------:|
| Manager   | <i class="fa fa-check"></i> | <i class="fa fa-check"></i> |
| Admin API | <i class="fa fa-check"></i> | <i class="fa fa-check"></i> |

{% if_version lte:3.4.x %}
| Vitals |<i class="fa fa-times"></i> |<i class="fa fa-check"></i> |
| Dev Portal |<i class="fa fa-times"></i> |<i class="fa fa-check"></i> |
{% endif_version %}

| Enterpriseプラグイン |<i class="fa fa-times"></i> | <i class="fa fa-check"></i> |

ライセンスファイルのデプロイ
--------------

* **ハイブリッドモードの展開：** ライセンスファイルを各コントロールプレーン（CP）と データプレーン（DP）にデプロイする必要があります。Kong Admin APIを通じてコントロールプレーン（CP）に ライセンスを適用します。コントロールプレーン（CP）はライセンスをデータプレーン（DP）ノードに配布します。 これは、ライセンスをデータプレーン（DP）に自動的に適用する唯一の方法です。
* **独立したコントロールプレーンがない従来のデプロイメント:** ライセンスファイルは、{{site.base_gateway}}を実行している各ノードにデプロイされる必要があります。

ライセンスファイルのチェックは、Kongの処理が開始するとともに、各ノードによって個別に実行されます。ライセンス検証プロセスを実行するのにネットワーク接続性は必要ありません。

{{site.base_gateway}}ノードでライセンスファイルを構成する方法は複数あります。これらは、Kongによってチェックされる順序で以下のように定義されます。

1. 存在する場合は、環境変数`KONG_LICENSE_DATA`の内容が使用されます。
2. Kongは、デフォルトの場所 `/etc/kong/license.json`で検索します。
3. 存在する場合、環境変数`KONG_LICENSE_PATH`で定義されたファイルの内容が使用されます。
4. `/licenses` Admin API エンドポイントを使用してライセンスを直接デプロイします。

この方法では、ライセンスファイルは、ノードファイルシステム上のファイルとして、環境変数として、 または`/licenses` Admin APIエンドポイントを介して、デプロイできます。最も簡単な方法は、Admin APIを使用することです。

他のほとんどの`KONG_*`環境変数とは異なり、`KONG_LICENSE_DATA`と`KONG_LICENSE_PATH` は、`kong` CLI コマンドの一部としてインラインで定義できません。ライセンスファイルの環境変数は、`kong`CLIツールの前に、Nginxプロセスが実行されるシェルにエクスポートする必要があります。

詳細については、[ライセンスをデプロイする](/gateway/{{page.release}}/licenses/deploy/)を参照してください。

{{site.base_gateway}} ノード上のライセンスデータの確認
----------------------

Admin APIの`/licenses`エンドポイント、またはKong Manager のAdmin GUIを使用してライセンスデータを取得します。

ライセンスの有効期限
----------

ライセンスは、マシンが稼働しているタイムゾーンに応じて、有効期限日の00:00に期限切れになります。

Kong Managerは、ライセンス有効期限の15日前からライセンス有効期限の警告を示すバナーを表示します。有効期限の警告は[{{site.base_gateway}}ログ](#license-expiration-logs)にも表示されます。

ライセンスの有効期限が切れると、{{site.base_gateway}}は次のように動作します。

* Kong Manager とその構成にはアクセスでき、変更も可能ですが、[Enterprise固有の機能](/gateway/{{page.release}}/kong-enterprise/)は読み取り専用になります。
* Admin API を使用すると、OSS 機能は引き続き動作し、構成された {{site.ee_product_name}} 機能は読み取り専用モードで継続して動作することができます。
* Enterpriseプラグインを使用するトラフィックを含むプロキシトラフィックは、ライセンスの有効期限が失効していないものとして引き続き処理されます。
* その他の Enterprise 機能にはアクセスできません。
* まだ書き込み可能な Enterprise 機能があるかもしれませんが、後で変更される可能性もあるため、この動作を前提にしないでください。

各デプロイメントモードの動作は、以下のとおりです。

* **従来型:** ノードは必要に応じて再起動/スケーリングできます。
* **ハイブリッド:** 既存のデータプレーンまたは新しいデータプレーンは、ライセンスの有効期限が切れたコントロールプレーンからの構成を **受け入れることができます** 。
* **DB\-lessとKIC:** 新しいノードを立ち上げることが **できず** 、再起動が中断されます。

新しいライセンスをアップロードするには、[Enterprise ライセンスのデプロイ](/gateway/{{page.release}}/licenses/deploy/)を参照してください。

### ライセンスの有効期限ログ


{{site.base_gateway}}は、次のスケジュールでライセンスの有効期限日を記録します。

* 90日前：`WARN`ログエントリを1日1回
* 30 日前: `ERR` ログエントリを 1 日 1 回
* 期限切れ時および期限切れ後: `CRIT` ログエントリを 1 日 1 回

トラブルシューティング
-----------

有効なライセンス ファイルが適切にデプロイされている場合、ライセンス ファイルの検証は透過的な操作であり、追加の出力やログ データは書き込まれず、提供されません。ライセンスの検証中にエラーが発生した場合、またはライセンス データが有効でない場合は、エラー メッセージがコンソールに書き込まれ、Kong エラー ログに記録され、その後プロセスが終了します。以下に、発生する可能性のあるエラー メッセージとトラブルシューティング手順を示します。

`license path environment variable not set`
：`KONG_LICENSE_DATA`または`KONG_LICENSE_PATH`の関数変数が定義されておらず、ライセンスファイルがデフォルトのライセンスロケーション（`/etc/kong/license.json`）で開くことができません。

`internal error`
：ライセンスの検証中に内部エラーが発生しました。このようなケースが発生する可能性は非常に低いため、さらにトラブルシューティングを行うには、Kongサポートにお問い合わせください。

`error opening license file`
：デフォルトの場所で、または`KONG_LICENSE_PATH`環境変数を使用して定義されたライセンスファイルを開くことができない。Nginxプロセスを実行しているユーザー（Kong CLIユーティリティを実行しているユーザーなど）にこのファイルを読み取る権限があることを確認します。

`error reading license file`
：デフォルトの場所で、または`KONG_LICENSE_PATH`環境変数を使用して、定義されたライセンスファイルを開くことができましたが、読み取り中にエラーが発生しました。ファイルが破損していないこと、カーネルエラーメッセージ（メモリ不足の状態など）が報告されていないことを確認してください。これは一般的なエラーであり、ファイルを開くことができれば、発生する可能性は極めて低いです。

`could not decode license json`
: ライセンスファイルデータが有効なJSONとして復号できません。ファイルが破損しておらず、Kong Inc.から受信したあとに変更されていないことを確認します。Kong Inc.からライセンスファイルを再ダウンロードしてインストールしてみてください。再インストール後もこのエラーが発生する場合は、Kongサポートにお問い合わせください。

`invalid license format`
: ライセンスファイルデータに1つ以上のキー/値ペアが欠落しています。ファイルが破損しておらず、Kong Inc.から受信したあとに変更されていないことを確認します。Kong Inc.からライセンスファイルを再ダウンロードしてインストールしてみてください。再インストール後もこのエラーが発生する場合は、Kongサポートにお問い合わせください。

`validation failed`
: ライセンスの署名を使ったライセンスのペイロードの検証に失敗しました。ファイルが破損しておらず、Kong Inc. から受信したあとに変更されていないことを確認します。Kong Inc. からライセンスファイルを再ダウンロードしてインストールしてみてください。再インストール後もこのエラーが発生する場合は、Kong サポートにお問い合わせください。

`license expired`
: システム時刻がライセンスの`license_expiration_date`を過ぎています。

`invalid license expiration date``license_expiration_date` フィールドのデータの形式が正しくありません。Kong Inc. からライセンスファイルを再ダウンロードしてインストールしてみてください。再インストール後もこのエラーが発生する場合は、Kong サポートにお問い合わせください。

