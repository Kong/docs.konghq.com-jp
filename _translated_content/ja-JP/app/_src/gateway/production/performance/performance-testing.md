---
title: "パフォーマンステストベンチマーク"
content_type: "reference"
description: "このドキュメントでは、現行バージョンのKong独自のベンチマークを含め、Kongのテストスイートを使用してKong Gatewayのパフォーマンステストを実施するための方法を総合的に提供します。"
---
{{site.base_gateway}} 3\.6\.x時点で、Kongは、 {{site.base_gateway}}のパフォーマンス結果を、テスト方法と詳細とともに公開しています。Kongは、今後のマイナーリリースごとに{{site.base_gateway}}のパフォーマンス結果を実施し、公開する予定です。

パフォーマンステストの結果を表示するだけでなく、[公開テストスイート](https://github.com/Kong/kong-gateway-performance-benchmark/tree/main)を使用して{{site.base_gateway}}で独自のパフォーマンステストを実施することもできます。

{{page.release}}の{{site.base_gateway}}パフォーマンステスト方法と結果
--------------------------

Kongは[当社の公開テストスイート](https://github.com/Kong/kong-gateway-performance-benchmark/tree/main)を使用して、{{site.base_gateway}}のパフォーマンス結果をテストします。

次のセクションでは、テストの方法、結果、および構成について説明します。

### 試験方法

パフォーマンステストでは、{{site.base_gateway}} のさまざまなベースライン構成と一般的なユースケースをカバーします。次に、使用されるテストケースと構成方法について説明します。

* **環境** : AWS インフラでの Kubernetes 環境。
* **ユースケースのテスト** 
  * 基本的な{{site.base_gateway}}プロキシ。
  * 認証なしでリクエストを[流量制限](/hub/kong-inc/rate-limiting/)します。
  * [Basic Authプラグイン](/hub/kong-inc/basic-auth/)と流量制限を使用した認証。
  * [Key Authプラグイン](/hub/kong-inc/key-auth/)と流量制限を使用した認証。

* **ルートとコンシューマ** : 各ケースを、次の 2 つの異なるオプションでテストしました。1 個のルートと 1 人のコンシューマを使用する場合と 100 個のルートと 100 人のコンシューマを使用する場合で、テストケースとしては合計 8 個です。認証を必要としないテストケースでは、コンシューマは使用しませんでした。
* **トラフィック分布** ：ルートとコンシューマの両方で正規分布。
* **プロトコル** HTTPSのみ。
* **サンプル数** ：各テストケースは5回、それぞれ15分間実行されました。結果は、5回のテスト実行の平均です。

### {{site.base_gateway}} {{page.release}} パフォーマンスベンチマークの結果

{% if_version eq:3.6.x %}
| テストタイプ                   | ルート数/コンシューマ数  | Requests per second \(RPS\) | P99 \(ms\) | P95 \(ms\) |
| \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\- | \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\- | \-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\- | \-\-\-\-\-\-\-\- | \-\-\-\-\-\-\-\- |
| プラグインなしのKongプロキシ  | 1ルート、0コンシューマ       | 137850\.4                  | 6\.25     | 3\.82     |
| プラグインなしのKongプロキシ  | 100ルート、0コンシューマ    | 132302\.8                  | 6\.55     | 3\.99     |
| 流量制限あり、認証なし      | 1ルート、0コンシューマ       | 116413\.8                  | 7\.59     | 4\.56     |
| 流量制限あり、認証なし      | 100ルート、0コンシューマ    | 111615\.8                  | 7\.62     | 4\.54     |
| 流量制限とキー認証     | 1ルート、1コンシューマ         | 102261\.6                  | 8\.47     | 5\.05     |
| 流量制限とキー認証     | 100ルート、100コンシューマ   | 96289\.6                   | 8\.82     | 5\.25     |
| 流量制限と基本認証   | 1ルート、1コンシューマ         | 95297\.8                   | 8\.75     | 5\.66     |
| 流量制限と基本認証   | 100ルート、100コンシューマ   | 89777\.4                   | 9\.34     | 5\.89     |
{% endif_version %}

{% if_version eq:3.7.x %}

|      テストタイプ      |   ルート数/コンシューマ数   | 1 秒あたりのリクエスト数（RPS） | P99 \(ms\) | P95（ミリ秒） |
|------------------|------------------|--------------------|--------------|----------|
| プラグインのないKongプロキシ | 1ルート、0コンシューマ     | 137358\.8         | 7\.25       | 4\.06   |
| プラグインのないKongプロキシ | 100ルート、0コンシューマ   | 133953\.4         | 7\.20       | 4\.17   |
| 流量制限あり、認証なし      | 1ルート、0コンシューマ     | 121737\.2         | 7\.69       | 4\.01   |
| 流量制限あり、認証なし      | 100ルート、0コンシューマ   | 117521\.4         | 8\.53       | 4\.22   |
| 流量制限とキー認証        | 1ルート、1コンシューマ     | 103777\.6         | 9\.43       | 4\.39   |
| 流量制限とキー認証        | 100ルート、100コンシューマ | 98777\.5          | 9\.16       | 4\.79   |
| 流量制限と基本認証        | 1ルート、1コンシューマ     | 97397\.6          | 9\.69       | 4\.93   |
| 流量制限と基本認証        | 100ルート、100コンシューマ | 92372\.6          | 10\.17      | 5\.31   |

{% endif_version %}

### テスト環境

KongはEC2マシンを使用し、AWSでこれらのテストを実行しました。[Kubernetesのテイント](https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/)を使用して、{{site.base_gateway}}が独自のノード上にあり、読み込みテストおよび監視ツールが同じクラスタ内の独自の個別のノード上にあることを確認しました。

{{site.base_gateway}}はc5\.4xlargeの単一の専用インスタンスで実行され、オブザーバビリティスタックとK6の2つのノードは専用のc5\.metalインスタンスで実行されました。オブザーバビリティ負荷生成ツールチェーンにはメタルインスタンスを使用して、リソースに制約がないことを確認しました。テスト中に大量のトラフィックを生成する場合、[K6は非常にリソースを必要とする](https://k6.io/docs/testing-guides/running-large-tests/#hardware-considerations)ため、ツールチェーンに小さいインスタンスやそれほど強力ではないインスタンスを使用すると、オブザーバビリティ負荷生成ツールが{{site.base_gateway}}パフォーマンスのボトルネックになることがわかりました。

### テスト構成

これらのテストでは、ワーカープロセスの数を変更して、{{site.base_gateway}} を実行しているノードの使用可能なコアの数（16 vCPU）と一致するようにしました。そのため、プロセス数を 16 に設定しました。これは[Kong の全体的なパフォーマンス ガイダンス](/gateway/latest/production/sizing-guidelines/)に準拠しています。この変更以外のチューニングは行われませんでした。

Kong のテストスイートを使用して独自のパフォーマンステストを実施する
------------------------------------

[Kongのパブリックテストスイートリポジトリ](https://github.com/Kong/kong-gateway-performance-benchmark/tree/main)を使用すると、{{site.base_gateway}}、Redis、Prometheus、GrafanaがインストールされたEKSクラスタのスピンアップをサポートします。さらに、人気のオープンソース負荷テストツールである[K6](https://k6.io/)を構成します。このテストスイートを使用して、独自のパフォーマンステストを実行できます。

クラスタが生成されたら、[提供されている`yaml`](https://github.com/Kong/kong-gateway-performance-benchmark/tree/main/deploy-k8s-resources/kong_helm)を適用して、含まれているテストケース用に{{site.base_gateway}}を構成し、クラスタですでにプロビジョニングされているPrometheusインスタンスによるメトリクスクレイピング用のオブザーバビリティプラグインを設定できます。独自のテストシナリオを定義したい場合は、テストしたい{{site.base_gateway}}構成を定義して、クラスタに適用することもできます。

そこから、[付属のbashスクリプトを使用してK6テストを実行](https://github.com/Kong/kong-gateway-performance-benchmark/tree/main/deploy-k8s-resources/k6_tests)できます。テストが完了したら、クラスタに`port-forward`して、パフォーマンス結果を含むGrafanaダッシュボードを表示できます。

その他の情報
------

* [{{site.base_gateway}}パフォーマンスベンチマークの確立](/gateway/{{page.release}}/production/performance/benchmark)：パフォーマンスのために{{site.base_gateway}}を最適化する方法をご紹介します。

