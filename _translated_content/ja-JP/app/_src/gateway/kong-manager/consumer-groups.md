---
title: "Kong Manager でコンシューマグループを作成"
content_type: "tutorial"
---
コンシューマグループを使用すると、必要な数の流量制限ティアを定義して、コンシューマのサブセットに適用できるため、コンシューマを個別に管理する必要がありません。

たとえば、次の3つのコンシューマグループを定義できます。

* 毎分1000リクエストの「ゴールドティア」
* 毎秒10リクエストの「シルバーティア」
* 30秒あたり6リクエストの「ブロンズレベル」

`consumer_groups`エンドポイントは、限られたプラグインのセットと連携して動作します。詳細については、[スコープの互換性表](/hub/plugins/compatibility/#scopes)を参照してください。

コンシューマグループに属していないコンシューマは、デフォルトでRate Limiting Advancedプラグインの設定に従うため、一部のユーザーの階層グループを定義し、グループに属さないコンシューマに対してはデフォルトの動作を設定できます。

コンシューマグループを使用して流量制限するには、以下を行う必要があります。

* 1つ以上のコンシューマグループを作成する
* コンシューマを作成します
* コンシューマをグループに割り当てる
* `enforce_consumer_groups`および`consumer_groups`パラメータを使用して Rate Limiting Advancedプラグインをグローバルに設定し、プラグインが受け入れるコンシューマグループの リストを設定します。
* 各コンシューマグループに流量制限ポリシーを設定し、プラグインの グローバル構成を上書きします。

すべてのリクエストについては、
[消費者グループのリファレンス](/gateway/api/admin-ee/3.3.0.x/#/consumer_groups/get-consumer_groups)。

コンシューマを含むコンシューマグループの設定
----------------------

このセクションでは、そのグループに割り当てられたコンシューマがいるブロンズティアのコンシューマグループを作成します。

1. **デフォルト** のワークスペースを開きます。
2. メニューから **コンシューマ** を開き、 **グループ** タブをクリックします。
3. **新しいコンシューマグループ** をクリックします。
4. コンシューマグループ名として `Bronze` を入力し、 **作成** をクリックします。
5. メニューの **コンシューマ** をクリックし、 **新規コンシューマ** をクリックします。
6. **ユーザー名** と **カスタム ID** を入力します。この例では、各フィールドに `Amal` を使用できます。
7. **作成** をクリックします。
8. メニューから **グループ** タブをクリックします。
9. 作成した `Bronze` コンシューマグループをクリックします。
10. **コンシューマ** と **コンシューマを追加** をクリックして、作成した `Amal` コンシューマを `Bronze` コンシューマグループに追加します。

すべてのコンシューマに対してRate Limiting Advancedプラグインを構成
--------------------------------------------

このセクションでは、Rate Limiting Advancedプラグインを構成して、すべてのコンシューマを対象に30秒あたり5リクエストに流量制限を設定します。

1. **デフォルト** のワークスペースを開きます。

2. メニューから **プラグイン** を開き、 **プラグインのインストール** をクリックします。

3. **Rate Limiting** プラグインを見つけて、 **有効にする** をクリックします。

4. プラグインを **グローバル** として適用すると、流量制限はワークスペース内のすべてのサービスとルートを含むすべてのリクエストに適用されます。

   **Scoped** に切り替えると、流量制限はプラグインを1つのサービス、ルート、またはコンシューマだけに適用します。

   デフォルトでは、フォームが送信されるとプラグインは自動的に有効になります。また、 **このプラグインは有効になっています** ボタンを切り替えて、プラグインを有効にせずに構成することもできます。この例では、プラグインを有効のままにします。
5. 次のフィールドのみに、次のパラメータを入力します。

   1. config.limit：`5`
   2. config.window\_size: `30`
   3. config.window\_type:`sliding`
   4. config.retry\_after\_jitter\_max：`0`
   5. config.enforce\_consumer\_groups: `true`
   6. config.consumer\_groups: `Bronze`

   上記のフィールド以外にも、デフォルト値が設定されているフィールドが存在する場合があります。この例では、残りのフィールドはそのままにしておきます。
6. **インストール** をクリックします。

コンシューマグループの流量制限の構成
------------------

このセクションでは、Rate Limiting Advanced プラグインを構成して、ブロンズティアのコンシューマのみを対象に、30 秒あたり 6 リクエストに流量制限を設定します。

1. **デフォルト** のワークスペースを開きます。
2. メニューから **コンシューマ** を開き、 **グループ** タブをクリックします。
3. 作成した `Bronze` コンシューマグループをクリックします。
4. **Policy** タブをクリックします。
5. 次のパラメータを使用して、次のフィールドのみを入力してください。 
   1. config.limit：`6`
   2. config.window\_size: `30`
   3. config.window\_type:`sliding`
   4. config.retry\_after\_jitter\_max：`0`

6. **保存** をクリックします。

