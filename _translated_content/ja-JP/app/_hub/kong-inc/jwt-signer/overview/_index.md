---
nav_title: 概要
---

Kong JWT Signer プラグインは、リクエスト内の 1 つまたは 2 つのトークンを検証、署名、または再署名することが可能です。2 つのトークンを使用する場合、1 つのトークンはエンドユーザーに割り当てられ、もう 1 つのトークンはクライアントアプリケーションに割り当てられます。

プラグインでは、トークンを _アクセス トークン_ と _チャネル トークン_ と呼んでいます。トークンは、有効な検証可能なトークンであれば何でも構いません。プラグインは、インスペクションを介した不透明なトークンと、署名検証を介した署名済み JWT トークンの両方をサポートしています。要件に合わせて多くの構成パラメータが利用可能です。

## 構成の注意事項

プラグインのほとんどの構成パラメータはオプションですが、プラグインを実際に動作させるためにはいくつかのオプションを指定する必要があります:

* たとえば、`config.access_token_jwks_uri` と/または `config.channel_token_jwks_uri` をプラグインが知っていることなしに署名の検証はできません。

* インスペクションが機能するためにも、インスペクションエンドポイント `config.access_token_introspection_endpoint` と/または `config.channel_token_introspection_endpoint` を指定する必要があります。

## キーの署名管理

`config.access_token_keyset` または `config.channel_token_keyset` を `http://` または `https://` 接頭辞で指定すると、トークンの署名キーが外部で管理されることを意味します。その場合、プラグインは `config.access_token_jwks_uri` と `config.channel_token_jwks_uri` と同様にキーを読み込みます。接頭辞が `http://` または `https://` でない場合（たとえば `"my-company"` または `"kong"`）、Kong はサポートされるアルゴリズムの JWKS を自動生成します。

`config.access_token_keyset` または `config.channel_token_keyset` で指定された外部の JWKS には、現時点で `"RS256"` または `"RS512"` のサポートされる `alg` を持つプライベートキーも含める必要があります。プライベートキーを含む外部の URL は、Kong のみがアクセスできるように保護されている必要があります。現時点では、Kong は外部エンドポイントからキーを読み込む際に認証ヘッダーを追加しません。そのため、ネットワークレベルの制限でそれを行う必要があります。プライベートキーを Kong が自動生成するのではなく、外部で管理する必要があるというニーズが一般的であれば、認証ヘッダーを追加するための別のパラメータを追加することができます（おそらく `config.channel_token_introspection_authorization` に類似したもの）。

RSA キーのモジュロ（サイズ）は現在 2048 ビットにハードコードされています。

## コンシューマのマッピング

以下のパラメータを使用して、コンシューマのマッピングを提供できます:

- `config.access_token_consumer_claim`
- `config.access_token_introspection_consumer_claim`
- `config.channel_token_consumer_claim`
- `config.channel_token_introspection_consumer_claim`

マッピングは 1 回だけ行うことができます。プラグインは、次の順序でマッピングを適用します:

1. アクセストークンのインスペクション結果
2. アクセストークンの JWT ペイロード
3. チャネルトークンのインスペクション結果
4. チャネルトークンの JWT ペイロード

マッピングの順序は入力に依存します（不透明または JWT）。

マッピングが完了すると、他のマッピングは使用されません。アクセストークンがすでに Kong コンシューマにマップされている場合、プラグインはチャネルトークンをコンシューマにマップしようとしませんし、その場合でもエラーは発生しません。

一般的なルールとして、アクセストークンまたはチャネルトークンのどちらかをマップすることです。

## Kong Admin API エンドポイント

このプラグインはいくつかの Admin API エンドポイントを提供し、それらに対するいくつかのアクションも行います。

### キャッシュ済み JWKS Admin API エンドポイント

プラグインは、`config.access_token_jwks_uri` と `config.channel_token_jwks_uri` で指定された JWKS を Kong データベースにキャッシュし、それらへのアクセスを高速化します。さらに、プラグインは Kong ノードの共有メモリ内とプロセスレベルのメモリ内に JWKS をキャッシュします。トークンの署名をプラグインが担当している場合、プラグインは独自のキーもデータベースに保存します。

Admin API エンドポイントはプライベートキーを公開しませんが、公開キーを公開します。プラグインが自動生成するプライベートキーは、現時点ではデータベースからのみアクセス可能です。JWKS 内のプライベート部分には `d`、`p`、`q`、`dp`、`dq`、`qi`、`oth` などのプロパティが含まれます。対称アルゴリズムを使用している公開キーの場合（`HS256` など）、`k` パラメータが含まれているため、それは Admin API から隠されません。これは実際には検証と署名の両方に使用されるため、少し問題があります。そのため、非対称（または公開鍵）アルゴリズムの使用を強くお勧めします。このようにすると、公開キーを各当事者間で共有し、秘密を明らかにせずに公開することができるため、キーの回転が容易になります。

Kong が読み込んだり生成したりしたすべての公開キーを表示します:

