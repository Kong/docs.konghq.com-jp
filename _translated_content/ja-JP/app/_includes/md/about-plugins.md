プラグインとは何か
---------

{{site.base_gateway}}は、一般的に *プラグイン* と呼ばれるモジュールを読み込んで実行するために設計されたLuaアプリケーションです。プラグインは高度な機能を提供し、{{site.base_gateway}}の使用を拡張するため、実装により多くの機能を追加できるようになります。

Kong は、{{site.base_gateway}}と{{site.konnect_short_name}}にバンドルされる一連の[標準Luaプラグイン](/hub/?support=kong-inc)を提供します。アクセスできるプラグインのセットは、[ライセンスティア](/hub/plugins/license-tiers/)によって異なります。

[カスタムプラグインを開発](#developing-custom-plugins)して、{{site.base_gateway}}に独自のカスタム機能を追加することもできます。

スコーププラグイン
---------

環境のニーズに応じて、さまざまな文脈においてプラグインを実行できます。各プラグインはグローバルに実行することも、以下の組み合わせに拡大することもできます。

* サービス
* ルート
* コンシューマ
* コンシューマグループ

スコープを使用すると、リクエストがバックエンドサービスに送信される前、あるいは応答を受信した後など、Kongが環境内で関数を処理する方法をカスタマイズできます。たとえば、プラグインを1つの[**ルート**](/gateway/latest/key-concepts/routes/)に適用した場合、そのプラグインは、リクエストがシステムを通過する特定のパスでのみトリガーされます。
一方、プラグインを[**グローバル**](#global-scope)に適用すると、他の構成に関係なく、すべてのリクエストで実行されます。

### グローバルスコープ

サービス、ルート、コンシューマ、またはコンシューマグループに関連付けられていないグローバルプラグインはグローバルと見なされ、他の構成に関係なく、すべてのリクエストで実行されます。

* 自己管理型の{{site.ee_product_name}}では、プラグインは特定のワークスペース内のすべてのエンティティに適用されます。
* 自己管理型 {{site.ce_product_name}} では、プラグインは環境全体に適用されます。
* {{site.konnect_short_name}}では、プラグインは特定のコントロールプレーン（CP）内のすべてのエンティティに適用されます。

すべてのプラグインはこれらのスコープのサブセットをサポートします。

各プラグインでサポートされているすべてのスコープについては、[スコープ互換性](/hub/plugins/compatibility/#scopes)リファレンスを参照してください。

### 優先順位

1つのプラグインインスタンスは1つのリクエストにつき、常に *1回* 実行されます。実行される際の構成は、プラグインが構成されているエンティティによって異なります。プラグインは、さまざまなエンティティ、エンティティの組み合わせ、またはグローバルにも構成できます。これは、たとえばほとんどのリクエストに対しては特定の方法でプラグインを設定したいけれど、 *認証されたリクエスト* に対しては多少異なる動作にしたい場合に役立ちます。

したがって、構成が異なるさまざまなエンティティに適用された場合、プラグインを実行する優先順位が存在します。特定のプラグインに構成されているエンティティの数は、そのプラグインの優先度に直接相関します。プラグインが構成されているエンティティの数が多いほど、優先順位が高くなります。

複数のエンティティに設定されたプラグインの完全な優先順位は次のとおりです。

1. **コンシューマ** \+ **ルート** \+ **サービス** ：最も優先度が高く、特定のルートとサービス上の特定のコンシューマからの認証されたリクエストに影響します。
2. **コンシューマグループ** \+ **サービス** \+ **ルート** : 特定のサービスおよびルートにわたる認証ユーザーのグループに影響します。
3. **コンシューマ** \+ **ルート** : 特定のルート上の特定のコンシューマからの認証されたリクエストをターゲットにします。
4. **コンシューマ** \+ **サービス** : 指定されたサービス内の任意のルートにアクセスする特定のコンシューマから認証されたリクエストに適用されます。
5. **コンシューマグループ** \+ **ルート** : 特定のルート上の認証されたユーザーのグループに影響します。
6. **コンシューマグループ** \+ **サービス** ：認証済みユーザーグループ向けの特定サービス内のすべてのルートに適用されます。
7. **ルート** \+ **サービス** : 特定のルートとサービスを利用するすべてのコンシューマを対象とします。
8. **コンシューマ** : すべてのルートとサービスにわたる、認証された特定のコンシューマからのすべてのリクエストに適用されます。
9. **コンシューマグループ** : 認証されたユーザーの指定されたグループのすべてのルートとサービスに影響します。
10. **ルート** ：指定されたルート専用。
11. **サービス** ：特定のサービス
12. **グローバルに設定されたプラグイン** : 優先順位が最も低く、コンシューマのステータスに関わらず、すべてのサービスとルートに渡りすべてのリクエストに適用されます。

{:.note}
> 
> **コンシューマグループの優先順位に関する注意** : コンシューマが2つのコンシューマグループのメンバーであり、それぞれにスコープ設定されたプラグインがある場合、{{site.base_gateway}} はこれらのプラグインの 1 つのみを実行することで、動作を決定します。ただし、この動作を制御する特定のルールは定義されておらず、将来のリリースで変更される可能性があります。

デプロイメントタイプとのプラグインの互換性
---------------------

{{site.base_gateway}} はさまざまな方法でデプロイでき、すべてのプラグインが各モードと完全に互換性があるわけではありません。比較については、[プラグインの互換性](/hub/plugins/compatibility#plugin-compatibility)を参照してください。

カスタムプラグイン
---------

### カスタムプラグインの開発

Kongは、プラグイン開発キット（PDK）、データベースの抽象化、移行など、プラグインを開発するための開発環境全体を提供します。

プラグインは、PDKを介してリクエストオブジェクト/レスポンスオブジェクトまたはストリームと対話するモジュールで構成され、任意のロジックを実装します。Kongは、次の言語でPDKを提供しています。

* [Lua](/gateway/latest/plugin-development/)
* [Go](/gateway/latest/plugin-development/pluginserver/go/)
* [Python](/gateway/latest/plugin-development/pluginserver/python/)
* [JavaScript](/gateway/latest/plugin-development/pluginserver/javascript/)

これらのPDKは、プラグインとKongのコア（または他のコンポーネント）との間の相互作用を容易にするためにプラグインが使用できる関数のセットです。

独自のプラグインの作成を開始するには、[入門ガイドのドキュメント](/gateway/latest/plugin-development/get-started/)を確認してください。
または次の参考文献を参照してください。

* [プラグイン開発キットのリファレンス](/gateway/latest/plugin-development/pdk/)
* [その他の言語サポート](/gateway/latest/plugin-development/pluginserver/go/)

### サードパーティのプラグイン

サードパーティとのパートナーシップを通して、Kong は Kong Plugin Hub に[サードパーティのカスタムプラグイン](/hub/?support=third-party-partner%2Ccommunity)をいくつかリストしています。
これらのプラグインは Kong パートナーによって管理されています。
自作のプラグインを Kong Plugin Hub で紹介したい場合は、[Kong のパートナー](https://konghq.com/partners/)になることをお勧めします。

関連項目
----

* [Kong Plugin Hub](/hub/)：すべてのKongバンドルプラグインとパートナープラグイン

参考資料

* [各プラグインでサポートされているスコープ](/hub/plugins/compatibility/#scopes)
* [各プラグインでサポートされているトポロジ](/hub/plugins/compatibility/)
* [各プラグインでサポートされているプロトコル](/hub/plugins/compatibility/#protocols)

プラグインのライセンスおよび価格のティア

* [自己管理型{{site.base_gateway}}ライセンスティア](/hub/plugins/license-tiers/)
* [{{site.konnect_short_name}}の価格帯](/konnect/compatibility/#plugin-compatibility)

